<!DOCTYPE html>
<html>
<head>
   <title>Textbook Reader</title>
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js" type="text/javascript"></script>
   <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
      typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.increment people.append people.track_charge".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||
      []);
      mixpanel.init("d1e8d75933581c403138c22a2753b747");</script><!-- end Mixpanel -->
      <style type="text/css">
      .pagenum {
         width: 33px;
         height: 34px !important;
         margin-top: 10px !important;
      }

      iframe {
         height: 1000px;
         width: 100%;
         border: none;
      }
      .center{
         text-align: center;
      }

      .btn {
         margin: 5px !important;
      }
      â€‹
      </style>
   </head>
   <body>
      <script src="http://eightmedia.github.com/hammer.js/hammer.js"></script>

      <script type="text/javascript">
      var BrowserDetect = {
         init: function () {
            this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
            this.version = this.searchVersion(navigator.userAgent)
            || this.searchVersion(navigator.appVersion)
            || "an unknown version";
            this.OS = this.searchString(this.dataOS) || "an unknown OS";
         },
         searchString: function (data) {
            for (var i=0;i<data.length;i++)  {
               var dataString = data[i].string;
               var dataProp = data[i].prop;
               this.versionSearchString = data[i].versionSearch || data[i].identity;
               if (dataString) {
                  if (dataString.indexOf(data[i].subString) != -1)
                     return data[i].identity;
               }
               else if (dataProp)
                  return data[i].identity;
            }
         },
         searchVersion: function (dataString) {
            var index = dataString.indexOf(this.versionSearchString);
            if (index == -1) return;
            return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
         },
         dataBrowser: [
         {
            string: navigator.userAgent,
            subString: "Chrome",
            identity: "Chrome"
         },
         {  string: navigator.userAgent,
            subString: "OmniWeb",
            versionSearch: "OmniWeb/",
            identity: "OmniWeb"
         },
         {
            string: navigator.vendor,
            subString: "Apple",
            identity: "Safari",
            versionSearch: "Version"
         },
         {
            prop: window.opera,
            identity: "Opera",
            versionSearch: "Version"
         },
         {
            string: navigator.vendor,
            subString: "iCab",
            identity: "iCab"
         },
         {
            string: navigator.vendor,
            subString: "KDE",
            identity: "Konqueror"
         },
         {
            string: navigator.userAgent,
            subString: "Firefox",
            identity: "Firefox"
         },
         {
            string: navigator.vendor,
            subString: "Camino",
            identity: "Camino"
         },
      {     // for newer Netscapes (6+)
         string: navigator.userAgent,
         subString: "Netscape",
         identity: "Netscape"
      },
      {
         string: navigator.userAgent,
         subString: "MSIE",
         identity: "Explorer",
         versionSearch: "MSIE"
      },
      {
         string: navigator.userAgent,
         subString: "Gecko",
         identity: "Mozilla",
         versionSearch: "rv"
      },
      {     // for older Netscapes (4-)
         string: navigator.userAgent,
         subString: "Mozilla",
         identity: "Netscape",
         versionSearch: "Mozilla"
      }
      ],
      dataOS : [
      {
         string: navigator.platform,
         subString: "Win",
         identity: "Windows"
      },
      {
         string: navigator.platform,
         subString: "Mac",
         identity: "Mac"
      },
      {
         string: navigator.userAgent,
         subString: "iPhone",
         identity: "iPhone/iPod"
      },
      {
         string: navigator.platform,
         subString: "Linux",
         identity: "Linux"
      }
      ]

   };
   BrowserDetect.init();

   $(document).ready(function() {
      name = prompt("Enter your ClassZone username - or, if you do not have one, your last name.");
      if (name) mixpanel.identify(name);
      gLIP();
      mixpanel.people.increment("readerloads");
      console.log('identified');
   });
   var cPage = 1;
   function goToPg(where, type) {
      console.log($('#book')[0].contentWindow.location);
      mixpanel.people.increment("pagesviewed");
      if (where == "prev") { cPage--; }
      else if (where == "next") { cPage++; }
      else { cPage = where; }

      mixpanel.track("goToPg",{"where": where, "name": name, "page": cPage, "type": type});

      $('.pagenum').val(cPage);

      $('#book')[0].src="http://www.classzone.com/cz/books/wh_survey05/secured/resources/applications/ebook/accessibility/patterns_survey/page_"+cPage+".pdf";
   }

   var leftKey = 37;
   var rightKey = 39;

   $(document).keydown(function(e){
      if (e.keyCode == leftKey) {
         goToPg("prev", "key");
         return false;
      } else if (e.keyCode == rightKey) {
         goToPg("next", "key");
         return false;
      }
   });
   </script>

   <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>

   <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

   <div class="center" id="top">
      <button class="btn btn-large btn-primary" onclick="goToPg('prev','button')" type="button">&lt;</button>
      <input class="pagenum" type="text" onkeypress="if(event.keyCode == 13 || event.characterCode == 13) { goToPg(this.value,'textbox'); }" value="0" />
      <button class="btn btn-large btn-primary" onclick="goToPg('next')" type="button">&gt;</button>
   </div>

   <iframe id="book" src="http://www.classzone.com/cz/books/wh_survey05/secured/resources/applications/ebook/accessibility/patterns_survey/page_1.pdf"></iframe>

   <script type="text/javascript">
   var hammer = new Hammer(document.getElementById("top"));
   hammer.onswipe = function(ev) { if (ev.direction == "left") { goToPg("next",'swipe'); } if (ev.direction == "right") { goToPg("prev",'swipe'); } };
   </script>
   <script type="text/javascript">
   function gLIP() {
      $.getJSON("http://www.bigrectangle.com/scripts/getip.php",
         function(data){ ip=data.ip.toString();
            console.log(ip);
            mixpanel.track("pageload", {"name": name, "ipaddr": ip.toString(), "screenheight":screen.height, "screenwidth":screen.width, "useragent": navigator.userAgent, "windowheight": $(window).height(), "windowwidth": $(window).width(), "browser": BrowserDetect.browser, "browsernum": BrowserDetect.version, "os": BrowserDetect.OS});
            mixpanel.people.set({
               "$last_login": new Date(),
               "$name": name,
               "$last_ua": navigator.userAgent,
               "$last_ip": ip.toString(),
               "$last_browser": BrowserDetect.browser,
               "$last_browser_num": BrowserDetect.version,
               "$last_screen_height":screen.height,
               "$last_screen_width":screen.width,
               "$last_window_height": $(window).height(),
               "$last_window_width": $(window).width(),
               "$last_os": BrowserDetect.OS,
               "$referrer": document.referrer
            });

         });
   }
   </script>
   <a href="https://mixpanel.com/f/partner"><img src="http://cdn.mxpnl.com/site_media/images/partner/badge_light.png" alt="Mobile Analytics" /></a>
</body>
</html>
